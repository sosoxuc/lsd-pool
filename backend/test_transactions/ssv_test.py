from web3 import Web3

abi = [{
    "inputs": [
        {
            "internalType": "bytes",
            "name": "publicKey",
            "type": "bytes"
        },
        {
            "internalType": "uint32[]",
            "name": "operatorIds",
            "type": "uint32[]"
        },
        {
            "internalType": "bytes[]",
            "name": "sharesPublicKeys",
            "type": "bytes[]"
        },
        {
            "internalType": "bytes[]",
            "name": "sharesEncrypted",
            "type": "bytes[]"
        },
        {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
        }
    ],
    "name": "registerValidator",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
}, {
    "inputs": [
        {
            "internalType": "address",
            "name": "ownerAddress",
            "type": "address"
        },
        {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
        }
    ],
    "name": "deposit",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
}]

web_th = Web3(Web3.HTTPProvider("https://eth-goerli.g.alchemy.com/v2/DZ3PctWctINI5rC9rUpMdGo_4eDtMEtr"))
account = web_th.eth.account.privateKeyToAccount("0xbc194f0753b2af1a4830772a0fec4226942b1b8a6ffcd5fd88ab31859c5654c6")
payload = {
    'validatorPublicKey': '0xb7b225d976f6928968ab2ccc6f3f3de8424b4b09ece0e3561119f650cc6a01419b7076378aedceebec6e9043721f9c0c',
    'operatorIds': '1,2,192,42', 'sharePublicKeys': [
        '0xaa43f6db83b0f0b8894fe8c0f4e64012f65146b6534358820cb5fd4c334c4de003a7bc9df2749f73ded063338cc15faf',
        '0xa5d8ea2dd4c47cda274801d924857683c6cf9def9afb2c835514299b417b7b72be8f8343993e39b8efc8e0b4138341d5',
        '0x924ceee22d69a865d6ba813c4983a5eb732832a7905bb963990dfc6d455d6d3ba62f57d35e3c6e5271c4ad4cd43b883a',
        '0xa2dba7a761a47a781bdf59e230b06ea166068314b738cd6916dc231bae9e6c51eabef7da1d504e68c281765c18d28d13'],
    'sharePrivateKey': [
        '0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001586877616a7569723448506d6e66547464445162714a6d50735232435a3468345730765a64354f644e6c4f47557231446635612b35414873366a6350445256684c394139353779624d2f332f4a317a5444723834462b71536f4d5a61385865646e4a6a694679474f544e334c5854464a43797177427755442b5173677a585269684c624757517075363164444d692f4d3076666c474c6f336b6b324554504a762b6d3032364f597a4d733677302b3376304b5a7674344141375338546531735448786b2f686159356b416c4f794854395354335347704e667879434238436266675a68576d72624d33454659484b656d78795346586e596c38314e3755534758506269313774725a73493559446d324e54377a637467302b2b5a2f706a5177486a307253656e374f4f784b793135394d6b5743416a736964574a5635344a53697a78434c636774474c50497759315947694b5a38596e413d3d0000000000000000',
        '0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000158436676784336755756724353383550506472446339422f304f51616b663438435a5252316633494136716b35347a42744b41376256326149533245663943454e73527841636e585a4153564a6261337a70744c693757424a423856534477616f506131624e70696a676339507258793176474c6c78466a3478647045356952664948494e43456d6444796f766c4245627177797530736d5030583967533330532b686a4a55474f683669616667703049685253686654334e5453772f756867692b2b4f6176624b326a445a36307a58764f73432b733749747a4e4147496c5631736258784175356d53736579534e674e47314d51414f37513244584b666f6a4c50316e775478534f687351534e444f4b6148786e37436832496842336b413037505074667977534a74506c2f6b4c33467365356b586550784d6d79546c596a5277482b3931523552586a484c79547271612b4a6d77513d3d0000000000000000',
        '0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001587457324e38534e4d3772457a4a59696e76794b625671396441664d734e353651306f367876756536387747792f497933455546446f4b304241504f33763868797a4f5263334f68364a526844446a52525677574e7a7942416e5665324476477675495a586f35437730346546387149465968322b777976544b364932757337485a433638786465417a436e74554d567a4663766a4c7777746145474d327157504a346531335368394b47345146654757672b656a5334524f68643030565a675844524363316864726b5461757854375a2f355938516e7639694638434b735444666b395a48495a3852356e3553367a6a783464446b4a2f3254435158417756352f724c6f6f766169644d55764a316c4456476e634d5875495231727a6f4630427655775753326472554b6a35586e4e64564c6e4e4c2b736c667149393137472f70347a5036415677372f743077694a4550797a6248513d3d0000000000000000',
        '0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000158545378692f5743333730694a764b4441644441786f69744d36746835615639747349487132446d6d4565557838414732572f6a516d6d796b4a396e5738436c7342374562757a656f454b2b3550525464477879503865456f48617856316632446d536c7a6a4c2b464d59514832454c6f4e6c4e734732715866484c786b3547714f6f6b61313832624f46684c7563346243674b714d4b476e5832705343616c5a534a57536e646b56302b3342644d633765505666787a4f7943753241375859534c4333435978697a6264557370337668397544434f38323344754b55714f4b77546858374d6748416c79394d6f796b7555506969335066326c616256354f78314358673962545a39757755545834666268644b752b63736278423262733150482b7454494450744f4e6c684a302b6a797570736a4249355a507448536d456155537547382b746c7a386f43352b3031746e6c79482b413d3d0000000000000000'],
    'ssvAmount': '16441451500878144000'}

# abi_token_ssv = [{
#     "inputs": [
#         {
#             "internalType": "address",
#             "name": "to",
#             "type": "address"
#         },
#         {
#             "internalType": "uint256",
#             "name": "amount",
#             "type": "uint256"
#         }
#     ],
#     "name": "transfer",
#     "outputs": [
#         {
#             "internalType": "bool",
#             "name": "",
#             "type": "bool"
#         }
#     ],
#     "stateMutability": "nonpayable",
#     "type": "function"
# }, {
#     "inputs": [
#         {
#             "internalType": "address",
#             "name": "spender",
#             "type": "address"
#         },
#         {
#             "internalType": "uint256",
#             "name": "amount",
#             "type": "uint256"
#         }
#     ],
#     "name": "approve",
#     "outputs": [
#         {
#             "internalType": "bool",
#             "name": "",
#             "type": "bool"
#         }
#     ],
#     "stateMutability": "nonpayable",
#     "type": "function"
# }]
# ssv = web_th.eth.contract(abi=abi_token_ssv, address=Web3.toChecksumAddress("0x3a9f01091c446bde031e39ea8354647afef091e7"))
# tx = ssv.functions.approve(Web3.toChecksumAddress("0xb9e155e65b5c4d66df28da8e9a0957f06f11bc04"), int(payload["ssvAmount"])*2).buildTransaction(
#     {'from': account.address, 'gasPrice': web_th.toWei('2', 'gwei'), 'gas': 1000000}
# )
# tx['nonce'] = web_th.eth.get_transaction_count(account.address)
#
# signed_tx = web_th.eth.account.sign_transaction(tx, account.key)
# tx_hash = web_th.eth.send_raw_transaction(signed_tx.rawTransaction)
# tx_receipt = web_th.eth.wait_for_transaction_receipt(tx_hash)
# print(tx_receipt)
# if tx_receipt.status == 1:
#     print('TX successful')
# else:
#     print('TX reverted')
# exit()
ssv = web_th.eth.contract(address=Web3.toChecksumAddress("0xb9e155e65b5c4d66df28da8e9a0957f06f11bc04"), abi=abi)
ids = [int(i) for i in payload["operatorIds"].split(",")]
print(ids)
print(payload["operatorIds"].split(","))
tx = ssv.functions.registerValidator("0xb7b225d976f6928968ab2ccc6f3f3de8424b4b09ece0e3561119f650cc6a01419b7076378aedceebec6e9043721f9c0c", [1,2,192,42],
                                     ["0xaa43f6db83b0f0b8894fe8c0f4e64012f65146b6534358820cb5fd4c334c4de003a7bc9df2749f73ded063338cc15faf",
                                      "0xa5d8ea2dd4c47cda274801d924857683c6cf9def9afb2c835514299b417b7b72be8f8343993e39b8efc8e0b4138341d5",
                                      "0x924ceee22d69a865d6ba813c4983a5eb732832a7905bb963990dfc6d455d6d3ba62f57d35e3c6e5271c4ad4cd43b883a",
                                      "0xa2dba7a761a47a781bdf59e230b06ea166068314b738cd6916dc231bae9e6c51eabef7da1d504e68c281765c18d28d13"],
                                     ["0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001586877616a7569723448506d6e66547464445162714a6d50735232435a3468345730765a64354f644e6c4f47557231446635612b35414873366a6350445256684c394139353779624d2f332f4a317a5444723834462b71536f4d5a61385865646e4a6a694679474f544e334c5854464a43797177427755442b5173677a585269684c624757517075363164444d692f4d3076666c474c6f336b6b324554504a762b6d3032364f597a4d733677302b3376304b5a7674344141375338546531735448786b2f686159356b416c4f794854395354335347704e667879434238436266675a68576d72624d33454659484b656d78795346586e596c38314e3755534758506269313774725a73493559446d324e54377a637467302b2b5a2f706a5177486a307253656e374f4f784b793135394d6b5743416a736964574a5635344a53697a78434c636774474c50497759315947694b5a38596e413d3d0000000000000000",
                                      "0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000158436676784336755756724353383550506472446339422f304f51616b663438435a5252316633494136716b35347a42744b41376256326149533245663943454e73527841636e585a4153564a6261337a70744c693757424a423856534477616f506131624e70696a676339507258793176474c6c78466a3478647045356952664948494e43456d6444796f766c4245627177797530736d5030583967533330532b686a4a55474f683669616667703049685253686654334e5453772f756867692b2b4f6176624b326a445a36307a58764f73432b733749747a4e4147496c5631736258784175356d53736579534e674e47314d51414f37513244584b666f6a4c50316e775478534f687351534e444f4b6148786e37436832496842336b413037505074667977534a74506c2f6b4c33467365356b586550784d6d79546c596a5277482b3931523552586a484c79547271612b4a6d77513d3d0000000000000000",
                                      "0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001587457324e38534e4d3772457a4a59696e76794b625671396441664d734e353651306f367876756536387747792f497933455546446f4b304241504f33763868797a4f5263334f68364a526844446a52525677574e7a7942416e5665324476477675495a586f35437730346546387149465968322b777976544b364932757337485a433638786465417a436e74554d567a4663766a4c7777746145474d327157504a346531335368394b47345146654757672b656a5334524f68643030565a675844524363316864726b5461757854375a2f355938516e7639694638434b735444666b395a48495a3852356e3553367a6a783464446b4a2f3254435158417756352f724c6f6f766169644d55764a316c4456476e634d5875495231727a6f4630427655775753326472554b6a35586e4e64564c6e4e4c2b736c667149393137472f70347a5036415677372f743077694a4550797a6248513d3d0000000000000000",
                                      "0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000158545378692f5743333730694a764b4441644441786f69744d36746835615639747349487132446d6d4565557838414732572f6a516d6d796b4a396e5738436c7342374562757a656f454b2b3550525464477879503865456f48617856316632446d536c7a6a4c2b464d59514832454c6f4e6c4e734732715866484c786b3547714f6f6b61313832624f46684c7563346243674b714d4b476e5832705343616c5a534a57536e646b56302b3342644d633765505666787a4f7943753241375859534c4333435978697a6264557370337668397544434f38323344754b55714f4b77546858374d6748416c79394d6f796b7555506969335066326c616256354f78314358673962545a39757755545834666268644b752b63736278423262733150482b7454494450744f4e6c684a302b6a797570736a4249355a507448536d456155537547382b746c7a386f43352b3031746e6c79482b413d3d0000000000000000"],
                                     16441451500878144000).buildTransaction(
    {'from': account.address, 'gasPrice': web_th.toWei('2', 'gwei'), 'gas': 5000000}
)
tx['nonce'] = web_th.eth.get_transaction_count(account.address)
web_th.eth.call(tx)
signed_tx = web_th.eth.account.sign_transaction(tx, account.key)
tx_hash = web_th.eth.send_raw_transaction(signed_tx.rawTransaction)
tx_receipt = web_th.eth.wait_for_transaction_receipt(tx_hash)
print(tx_receipt)
if tx_receipt.status == 1:
    print('TX successful')
else:
    print('TX reverted')
signed_tx = web_th.eth.account.sign_transaction(tx, account.key)
